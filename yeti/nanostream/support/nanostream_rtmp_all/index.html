<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>RTMP - nanocosmos Docs</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">
        <link href="../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">nanocosmos Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">nanostream <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Web</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../web/nanostream-4.x-web-api/">API Manual</a>
</li>

        
            
<li >
    <a href="../../web/nanostream_javascript_integration/">Javascript Integration</a>
</li>

        
    </ul>
  </li>

                    
                        
<li >
    <a href="../../ios/nanostream-ios-sdk/">iOS api</a>
</li>

                    
                        
<li >
    <a href="../../macos/nanostream-macos-sdk/">MacOS api</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Android</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../android/android_developer_manual_streaming/">Streaming Developer Manual</a>
</li>

        
            
<li >
    <a href="../../android/android_developer_manual_playback/">Playback Developer Manual</a>
</li>

        
            
<li >
    <a href="../../android/android_developer_manual_sample/">Sample Developer Manual</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Windows api</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../windows/windows_developer_manual/">Developer Manual</a>
</li>

        
            
<li >
    <a href="../../windows/windows_binares/">Binary Modules</a>
</li>

        
            
<li >
    <a href="../../windows/windows_license_help/">License Help</a>
</li>

        
            
<li >
    <a href="../../windows/windows_networkwriter/">RTMP Network Render & Writer</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Language Integration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../windows/language_integration/nanostream_cpp_integration/">C++</a>
</li>

        
            
<li >
    <a href="../../windows/language_integration/nanostream_csharp_integration/">C#</a>
</li>

        
            
<li >
    <a href="../../windows/language_integration/nanostream_delphi_integration/">Delphi</a>
</li>

        
            
<li >
    <a href="../../windows/language_integration/nanostream_activex_visualcpp/">VisualC</a>
</li>

        
            
<li >
    <a href="../../windows/language_integration/nanostream_activex_visualcpp_mfc/">MFC</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Direct Show</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_audio_volume/">Audio Volume</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">H.264</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_avc_h264/">AVC/H.264 Video Codec</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_nanoAVC_decoding_sdk/">nanoAVC/H.264 DirectShow Decoding</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_nanoAVC_encoding_sdk/">nanoAVC/H.264 DirectShow Encoding</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_h264_video_decoder/">H.264 Video Decoder Filter</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_h264_video_encoder/">H.264 Video Encoder Filter</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">MPEG</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_mpeg2_broadcast_sdk/">MPEG2 Broadcast SDK</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_mpeg2_video_decoder/">MPEG2 Video Decoder</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_mpeg2_video_encoder/">MPEG2 Video Encoder</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_mpeg_audio_encoder/">MPEG Audio Encoder</a>
</li>

        
    </ul>
  </li>

        
            
<li >
    <a href="../../directshow/directshow_quicktime_imx/">Quicktime IMX Playback</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">RTMP</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_rtmp_source/">RTMP Source</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_rtmp_writer/">RTMP Writer</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_rtmp_status_statistics/">RTMP Status & Statistics</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">RTSP</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_rtsp_sink/">RTSP Sink</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_rtsp_source/">RTSP Source</a>
</li>

        
    </ul>
  </li>

        
            
<li >
    <a href="../../directshow/directshow_udp_ts_streaming/">UDP/TS Streaming</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Video Filter</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../directshow/directshow_screen_capture_filter/">Screen Capture Filter</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_video_mixer/">Video Mixer PiP</a>
</li>

        
            
<li >
    <a href="../../directshow/directshow_overlay_mixing/">Video Mixer Overlay</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Additional Knowledge</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../nanostream_aec/">Acoustic Echo Cancellation</a>
</li>

        
            
<li >
    <a href="../nanostream_audio_levels/">Audio Level</a>
</li>

        
            
<li >
    <a href="../nanostream_bitrate_control_statistics/">Bitrate Control & Statistics</a>
</li>

        
            
<li >
    <a href="../nanostream_latency/">Latency</a>
</li>

        
            
<li >
    <a href="../nanostream_low_latency/">Low Latency</a>
</li>

        
            
<li >
    <a href="../nanostream_mixer_overlay/">Overlay Mixer</a>
</li>

        
            
<li >
    <a href="../nanostream_mp4_recording/">MP4 Recording</a>
</li>

        
            
<li >
    <a href="../nanostream_remote_server_recording/">Remote Server Recording</a>
</li>

        
            
<li >
    <a href="../nanostream_udp_ts_streaming/">UDP/TS Streaming</a>
</li>

        
            
<li class="active">
    <a href="./">RTMP</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">bintu.live <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../../bintu/android/bintu-android-sdk/">Android SDK</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">iOS</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../bintu/ios/bintu_ios_sdk/">SDK Documentation</a>
</li>

        
            
<li >
    <a href="../../../bintu/ios/bintu_ios_sample/">Sample Documentation</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../../about/">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../nanostream_udp_ts_streaming/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../../bintu/android/bintu-android-sdk/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#nanostream_rtmp_authentication">nanoStream RTMP Authentication</a></li>
        
            <li><a href="#general_information">General Information</a></li>
        
            <li><a href="#requirements">Requirements:</a></li>
        
            <li><a href="#installation">Installation:</a></li>
        
            <li><a href="#usage">Usage</a></li>
        
            <li><a href="#sample_web_application">Sample Web Application:</a></li>
        
    
        <li class="main "><a href="#rtmp_connect_data">RTMP Connect Data</a></li>
        
    
        <li class="main "><a href="#rtmp_metadata">RTMP Metadata</a></li>
        
            <li><a href="#example_json_for_onmetadata_handler">Example JSON for "onMetaData" handler</a></li>
        
            <li><a href="#example_json_for_oncuepoint_handler">Example JSON for "onCuePoint" handler</a></li>
        
            <li><a href="#more_information">More information</a></li>
        
    
        <li class="main "><a href="#rtmp_streaming_automatic_reconnect">RTMP Streaming Automatic Reconnect</a></li>
        
            <li><a href="#general_information_1">General Information</a></li>
        
            <li><a href="#available_reconnection_settings_for_use_with_plugin_or_directly_with_rtmp_writer">Available Reconnection Settings (for use with Plugin or directly with RTMP Writer)</a></li>
        
    
        <li class="main "><a href="#rtmp_statistics">RTMP statistics</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p><span style="font-size: 42px;"> RTMP Knowledge Base</span></p>
<h1 id="nanostream_rtmp_authentication">nanoStream RTMP Authentication<a class="headerlink" href="#nanostream_rtmp_authentication" title="Permanent link">&para;</a></h1>
<h2 id="general_information">General Information<a class="headerlink" href="#general_information" title="Permanent link">&para;</a></h2>
<p>This document describes the nanoStream 2.0 “RTMP Authentication” interface.</p>
<h2 id="requirements">Requirements:<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>Wowza Media Server 2.0 or higher</li>
<li>Wowza Plugin Module “Media Security”</li>
<li><a href="http://www.wowzamedia.com/forums/content.php?115" title="http://www.wowzamedia.com/forums/content.php?115">Wowza Media Security Link/Description</a>
or</li>
<li>FMS 3.5 or higher</li>
<li>FMS authentication addin</li>
<li><a href="http://help.adobe.com/en_US/FlashMediaLiveEncoder/3.2/Using/WS5b3ccc516d4fbf351e63e3d11c104ba878-7ff8.html" title="http://help.adobe.com/en_US/FlashMediaLiveEncoder/3.2/Using/WS5b3ccc516d4fbf351e63e3d11c104ba878-7ff8.html">Flash Media Authentication</a></li>
</ul>
<h2 id="installation">Installation:<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="installation_for_wowza">Installation for Wowza:<a class="headerlink" href="#installation_for_wowza" title="Permanent link">&para;</a></h3>
<ul>
<li>since version 3.5 the module is included in the server, see <a href="http://www.wowza.com/forums/content.php?449-How-to-enable-username-password-authentication-for-RTMP-and-RTSP-publishing-%28ModuleRTMPAuthenticate%29" title="http://www.wowza.com/forums/content.php?449-How-to-enable-username-password-authentication-for-RTMP-and-RTSP-publishing-%28ModuleRTMPAuthenticate%29">How-To enable username/password</a></li>
<li>Follow the download and unpack instructions from the download link</li>
<li>Edit the file Application.xml at [install-dir]/conf/[application]/</li>
<li>Add this <em>Module</em>  at the end of the <em>Modules</em> list:</li>
</ul>
<pre><code class="html">&amp;lt;Module&amp;gt;
&amp;lt;Name&amp;gt;ModuleRTMPAuthenticate&amp;lt;/Name&amp;gt;
&amp;lt;Description&amp;gt;ModuleRTMPAuthenticate&amp;lt;/Description&amp;gt;
&amp;lt;Class&amp;gt;com.wowza.wms.plugin.security.ModuleRTMPAuthenticate&amp;lt;/Class&amp;gt;
&amp;lt;/Module&amp;gt;
</code></pre>

<ul>
<li>Create a text file in the <em>[install-dir]/conf</em> folder named <em>connect.password</em>, then add a line with a username and password separate with a space for each user:
<code>[install-dir]/conf/connect.password:</code>
<em>user1 pass1</em>
<em>user2 pass2</em></li>
</ul>
<h3 id="installation_for_flash_media_server">Installation for Flash Media Server<a class="headerlink" href="#installation_for_flash_media_server" title="Permanent link">&para;</a></h3>
<ul>
<li>install the addin</li>
<li>open <code>cmd.ex</code> as admin and go to <code>FMSINSTALLDIR\conf</code></li>
<li>create <em>user</em> with users.exe add -u [username] -p [password]</li>
</ul>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Pass the user name and password to the nanoStream API with:</p>
<pre><code class="cpp">nanostream.SetConfig(&quot;Auth&quot;,&quot;user:password&quot;);
</code></pre>

<p>Start Streaming with</p>
<pre><code class="cpp">StartBroadcast();
</code></pre>

<h2 id="sample_web_application">Sample Web Application:<a class="headerlink" href="#sample_web_application" title="Permanent link">&para;</a></h2>
<p>See the HTML web page in the folder <code>web/liveEncoder/nanoStream.html</code>
The feature is implemented there under <em>Options</em>.</p>
<h1 id="rtmp_connect_data">RTMP Connect Data<a class="headerlink" href="#rtmp_connect_data" title="Permanent link">&para;</a></h1>
<p>nanoStream supports sending a user defined amf data object included in the RTMP connect call. The data can be handled in the <code>onConnect()</code> handler of the RTMP server. Common applications are custom authentication and transmission of additional user/setup information. If set, the data will be included in the next connect call.</p>
<p>The function <code>SetConnectInfo</code> is supported on Windows/MacOS/iOS/Android.
Parameters are <code>string jsonValues</code>, JSON object string.
Restrictions
- Top-level object must be an object.
- Cannot contain arrays or other objects.
- May only contain key-value pairs.</p>
<p>Example JSON showing a string, number and boolean value:</p>
<pre><code class="js">{
  &quot;key1&quot; : &quot;value1&quot;,
  &quot;key2&quot; : 7.5,
  &quot;key3&quot; : false
}
</code></pre>

<p>Line breaks are only used for clarity, JSON will more look like this:</p>
<pre><code class="js">{&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:7.5,&quot;key3&quot;:false}
</code></pre>

<p>&nbsp;</p>
<h1 id="rtmp_metadata">RTMP Metadata<a class="headerlink" href="#rtmp_metadata" title="Permanent link">&para;</a></h1>
<p>nanoStream supports sending user defined RTMP metadata during the stream. Common applications are the calls to onMetaData and onCuePoint handlers.
Function Name: <code>SendMetadata</code>
<em>Supported Platforms: Windows/MacOS/iOS/Android</em>
Parameters:
- <code>string handlerName</code>, Name of the handler, e.g. &ldquo;onMetaData&rdquo;,&rdquo;onCuePoint&rdquo; or a custom handler name &ldquo;onMyHandler&rdquo;
- <code>string jsonValues</code>, JSON object string, see example below
- <code>string type</code>, reserved, leave empty &ldquo;&rdquo;
- <code>boolean live</code>, Send metadata live/in-stream or non live which means that the metadata is aggregated at the server and sent at stream start of a player. Should be true in most cases.
<em>Restrictions</em>:
- Top-level object must be an object.
- Top-level object can contain objects and key/value pairs.
- Second-level objects cannot contain further nested objects.
- Cannot contain arrays.</p>
<h2 id="example_json_for_onmetadata_handler">Example JSON for &ldquo;onMetaData&rdquo; handler<a class="headerlink" href="#example_json_for_onmetadata_handler" title="Permanent link">&para;</a></h2>
<pre><code class="javascript">{
  &quot;key&quot; : &quot;value&quot;,
  &quot;nextkey&quot; : &quot;nextvalue&quot;,
  &quot;anotherkey&quot; : 14.0,
   &quot;lastkey&quot; : false
}
// Line breaks are only used for clarity.
// The real JSON string will more look like this:
{&quot;key&quot; : &quot;value&quot;, &quot;nextkey&quot; : &quot;nextvalue&quot;, &quot;anotherkey&quot; : 14.0, &quot;lastkey&quot; : false}
</code></pre>

<p>&nbsp;</p>
<h2 id="example_json_for_oncuepoint_handler">Example JSON for &ldquo;onCuePoint&rdquo; handler<a class="headerlink" href="#example_json_for_oncuepoint_handler" title="Permanent link">&para;</a></h2>
<pre><code class="javascript">{
  &quot;name&quot; : &quot;chapter1&quot;,
  &quot;type&quot; : &quot;event&quot;,
  &quot;time&quot; : 14.0,
  &quot;parameters&quot; :
  {
    &quot;parameter1&quot; : &quot;value1&quot;,
    &quot;parameter2&quot; : 0,
    &quot;parameter3&quot; : false
  }
}
</code></pre>

<p>// Line breaks are only used for clarity.
// The real JSON string will more look like this:</p>
<pre><code class="javascript">{&quot;name&quot;:&quot;chapter1&quot;,&quot;type&quot;:&quot;event&quot;,&quot;time&quot;:14.0,&quot;parameters&quot;:{&quot;parameter1&quot;:&quot;value1&quot;,&quot;parameter2&quot;:0,&quot;parameter3&quot;:false}}
</code></pre>

<p>&nbsp;</p>
<h2 id="more_information">More information<a class="headerlink" href="#more_information" title="Permanent link">&para;</a></h2>
<p>More information about RTMP metadata and cue points can be found here:
<em> <a href="http://help.adobe.com/en_US/as3/dev/WSD30FA424-950E-43ba-96C8-99B926943FE7.html" title="http://help.adobe.com/en_US/as3/dev/WSD30FA424-950E-43ba-96C8-99B926943FE7.html">Adobe Using cue points and metadata</a>
</em> <a href="http://help.adobe.com/en_US/ActionScript/3.0_UsingComponentsAS3/WS5b3ccc516d4fbf351e63e3d118a9c65586-7feb.html" title="http://help.adobe.com/en_US/ActionScript/3.0_UsingComponentsAS3/WS5b3ccc516d4fbf351e63e3d118a9c65586-7feb.html">Adobe Use cue points</a></p>
<h1 id="rtmp_streaming_automatic_reconnect">RTMP Streaming Automatic Reconnect<a class="headerlink" href="#rtmp_streaming_automatic_reconnect" title="Permanent link">&para;</a></h1>
<h2 id="general_information_1">General Information<a class="headerlink" href="#general_information_1" title="Permanent link">&para;</a></h2>
<p>Nanocosmos Rtmp streaming can be configured to try to reconnect after connection to the streaming server failed (for example due to unstable internet connection).</p>
<p>&lt;a id=&rdquo;reconnect_settings&rdquo;&gt;</p>
<h2 id="available_reconnection_settings_for_use_with_plugin_or_directly_with_rtmp_writer">Available Reconnection Settings (for use with Plugin or directly with RTMP Writer)<a class="headerlink" href="#available_reconnection_settings_for_use_with_plugin_or_directly_with_rtmp_writer" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>ReconnectAttempts</td>
<td>how often a reconnection should be attempted</td>
<td>0-max(int32). Default: 5</td>
</tr>
<tr>
<td>UseUnlimitedReconnect (<em>plugin</em>); PROPID_nanoRTMPUnlimitedReconnect(<em>rtmp-writer</em>)</td>
<td>unlimited reconnection attempts (filter graph is not stopped). Overrides ReconnectAttempts</td>
<td>0: disable, 1: enable</td>
</tr>
<tr>
<td>ReconnectPeriod</td>
<td>time to wait before a new reconnection attempt is made</td>
<td>100 ms - max(int32)ms. Values &lt; 100 ms disable Auto-reconnect. Default 5000 ms</td>
</tr>
<tr>
<td>UseInternalReconnect</td>
<td>if enabled, the filter graph is not restarted when trying to reconnect: local encoding and recording continues despite absent internet connection</td>
<td>0: disabled (reconnection is done by stopping and starting the filter graph), 1: enabled (use internal reconnect of rtmp-writer)</td>
</tr>
</tbody>
</table>
<p>If all reconnection attempts were unsuccessful, streaming will be stopped, except when <strong>UseUnlimitedReconnect</strong> is used.
<strong>Important</strong>
If a reconnection attempt was successful the internal reconnection counter is reset. For following disconnections, the rtmp writer tries again to reconnect the given number of reconnect attempts before stopping the encoder.</p>
<h3 id="using_reconnection_with_the_browser_plugin">Using Reconnection with the browser plugin<a class="headerlink" href="#using_reconnection_with_the_browser_plugin" title="Permanent link">&para;</a></h3>
<p>To use the reconnection ability of the rtmp writer <code>SetConfig(Option, Value)</code> can be used, see <a href="#reconnect_settings">Table Above</a> for available options and corresponding values.</p>
<h3 id="using_reconnection_with_the_rtmp_writer">Using Reconnection with the RTMP Writer<a class="headerlink" href="#using_reconnection_with_the_rtmp_writer" title="Permanent link">&para;</a></h3>
<p>Reconnection can be configured via the interface IRTMPOptions:</p>
<pre><code class="cpp">CComQIPtr&amp;lt;IRTMPOptions, &amp;amp;IID_IRTMPOptions&amp;gt; optRtmp = pSink;
if (optRtmp)
{
optRtmp-&amp;gt;SetReconnectInterval(reconnectPeriodValue);
optRtmp-&amp;gt;SetReconnectAttempts(reconnectAttemptsValue);
}
</code></pre>

<p>Further options are available via ICodecApi:</p>
<pre><code>CComQIPtr api = pSink;
if(SUCCEEDED(api-&amp;gt;IsSupported(&amp;amp;PROPID_nanoRTMPUnlimitedReconnect)))
{
VARIANT vt;
VariantInit(&amp;amp;vt);
vt.vt = VT_BOOL;
vt.boolVal = VARIANT_TRUE; // or VARIANT_FALSE
api-&amp;gt;SetValue(&amp;amp;PROPID_nanoRTMPUnlimitedReconnect, &amp;amp;vt);
}
</code></pre>

<h3 id="using_reconnection_with_xml">Using Reconnection with XML<a class="headerlink" href="#using_reconnection_with_xml" title="Permanent link">&para;</a></h3>
<p>See Also: <strong>LiveVideoEncoder-XML-Config</strong></p>
<pre><code class="html">&amp;lt;reconnectinterval&amp;gt;
&amp;lt;attempts&amp;gt;5&amp;lt;/attempts&amp;gt;
&amp;lt;interval&amp;gt;5000&amp;lt;/interval&amp;gt;
&amp;lt;restartgraph&amp;gt;false&amp;lt;/restartgraph&amp;gt; &amp;lt;!-- false: internal reconnect of the rtmp writer will be used--&amp;gt;
&amp;lt;unlimitedattempts&amp;gt;true&amp;lt;/unlimitedattempts&amp;gt; &amp;lt;!-- overrides attempts (5 in this example) --&amp;gt;
&amp;lt;/reconnectinterval&amp;gt;
</code></pre>

<p>&nbsp;</p>
<p><strong>restartgraph</strong> and <strong>UseInternalReconnect</strong> have reversed meaning:
<strong>restartgraph</strong> set to <em>false</em> enables usage of the rtmp-writer&rsquo;s internal reconnect, whereas <strong>UseInternalReconnect</strong> set to <em>0</em> disables usage of rtmp-writer&rsquo;s internal reconnect (reconnection is done by stopping and starting the filter graph).</p>
<h3 id="using_reconnection_to_keep_the_encoder_running">Using Reconnection to keep the encoder running<a class="headerlink" href="#using_reconnection_to_keep_the_encoder_running" title="Permanent link">&para;</a></h3>
<p>If the rtmp writer is disconnected from the streaming server URL, the whole encoder graph will be stopped. When a parallel stream to another destination is running, this recording will be stopped as well. This is especially important for the local mp4 file writer. To avoid this, you can use the option enable UseInternalReconnect (if the plugin is used) or SetReconnectAttempts, (if the RTMP Writer is used directly). The filter graph will then keep running until all reconnect attempts fail.</p>
<p><strong>Example</strong>
<code>reconnect attempts = 100</code>
<code>reconnect period = 6000 ms</code>
Here, the encoder will keep running for ten minutes if all reconnection attempts failed. If you use the option <code>UseUnlimitedReconnect</code>, resp. <code>PROPID_nanoRTMPUnlimitedReconnect</code> the graph will never be stopped by the rtmp filter - a reconnection attempt is made every <em>x</em> ms (depending on the specified value).</p>
<h1 id="rtmp_statistics">RTMP statistics<a class="headerlink" href="#rtmp_statistics" title="Permanent link">&para;</a></h1>
<p>The following pseudocode, shows how to query the connection status and the statistics of the RTMP Writer (<code>m_pMediaEventEx</code> is of type <code>IMediaEventEx</code>):</p>
<pre><code class="cpp">while (SUCCEEDED(m_pMediaEventEx-&amp;gt;GetEvent(&amp;amp;nEvCode, &amp;amp;param1, &amp;amp;param2, 0))) {
switch (nEvCode) {
case EC_NANO_RTMP_WRITER_STATUS:
{
RtmpWriterStatus *status = (RtmpWriterStatus*)param1;
switch(*status)
{
case RTMPWriterConnected: //...
case RTMPWriterDisconnected: //...
case RTMPWriterReconnecting: //...
}
}

case EC_NANO_RTMP_WRITER_STATS:
{
rtmp_writer_stats_t* stats = (rtmp_writer_stats_t*)param1;
//...
// if you use multiple rtmp writer you can identify which rtmp writer did send
// the statistics by using the second parameter (it contains the url, to which
// the rtmp writer is streaming
char* urlId = (char*)param2;
//...
}
}
}
</code></pre>

<p>Explanation of <code>rtmp_writer_stats_t</code>:
- <code>output_buffer_size</code> = max. available buffer in bytes
- <code>output_buffer_fillness</code> = how much bytes of the buffer are used
- <code>output_bitrate</code> = estimated bitrate of the stream
- <code>output_bitrate2</code> = similar to ouput_bitrate, but another (more accurate) method is used (only available if tcp sniffing is enabled - works only with win xp)
- <code>output_bitrate3</code> = similar to ouput_bitrate, but another method is used (only available if tcp sniffing is enabled - works only with win xp)
- <code>packetsRtt</code> = rount trip time (RTT) in ms
- <code>clientBytesReceived</code> = amount of received bytes
- <code>audio_buffered_samples</code> = amount of buffered samples for audio
- <code>video_buffered_samples</code> = amount of buffered samples for video
- <code>audio_bitrate</code> = current audio bitrate of the encoder
- <code>video_bitrate</code> = current video bitrate of the encoder</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>